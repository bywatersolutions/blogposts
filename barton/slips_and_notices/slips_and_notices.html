<h1 id="everything-you-wanted-to-know-about-slips-and-notices-but-were-afraid-to-ask">Everything You Wanted to Know About Slips and Notices But Were Afraid to Ask</h1>
<h2 id="some-terminology-first">Some terminology first:</h2>
<ul>
<li>Notices are messages that are generated by koha and sent to patrons</li>
<li>Slips are formatted similarly to notices, but can only be printed</li>
<li>These are configured on the 'Notices and Slips' page.</li>
<li>Repeating data on a notice or slip, such as <em>Title</em>, <em>Author</em> or <em>Date Due</em> is called 'detail'. These are usually bibliographic, but not always.</li>
<li>The templates for notices and slips are stored in the <code>LETTER</code> table. Note that this is not plural.</li>
<li>Each entry in the <code>LETTER</code> table has a <code>letter_code</code></li>
<li><code>&lt;&lt;</code> and <code>&gt;&gt;</code> are called <em>Hungry Alligators</em>. Whatever is between the hungry alligators is being 'eaten' by the hungry alligators.</li>
<li>Notices have a <code>message_transport_type</code> which tells Koha how the message is to be sent: <code>email</code>, <code>SMS</code>, <code>phone</code> or <code>print</code>.</li>
</ul>
<h2 id="life-cycle-of-a-notice">Life cycle of a notice</h2>
<ul>
<li><em>Something</em> in koha looks up a <code>LETTER</code> template. It will then
<ul>
<li>Fill in all the values being eaten by hungry alligators.</li>
<li>Add an entry into the <code>MESSAGE_QUEUE</code> table in the koha database.</li>
</ul></li>
<li>The message queue contains the borrower's email address, SMS number or phone number (depending on message transport type).</li>
<li>There is a cron job called <code>process_message_queue.pl</code> which looks at all of the pending messages in the <code>MESSAGE_QUEUE</code> and sends them out via the appropriate message transport (almost always email).</li>
<li>We can look at the mail server logs to see if the notice was successfully sent. If so, it's out of our hands.</li>
</ul>
<h2 id="ok-that-was-easy.-so-whats-the-big-deal-about-notices">OK, that was easy. So what's the big deal about notices?</h2>
<p>The problem with notices is that there are about 15 different 'Somethings' that send notices, and they don't agree on what the <code>LETTER</code> templates should look like. In particular, they're bad about how they handle detail.</p>
<p>To help me get a handle on this, I wrote the <a href="https://wiki.koha-community.org/wiki/Customising_Notices_and_Slips#Notice_Markup">Notices markup</a> page on the Koha wiki. This is broken down by letter code, 'Used in' (i.e. the <em>Something</em>), mentioned above, the detail syntax, and 'Accessible data'.</p>
<h2 id="notable-somethings">Notable <em>Something</em>s</h2>
<h3 id="notices-cron-jobs">Notices cron jobs</h3>
<ul>
<li><code>overdue_notices.pl</code></li>
<li><code>advance_notices.pl</code>
<ul>
<li><code>DUEDGST|PREDUEDGST</code> -- Use <code>&lt;&lt;items.content&gt;&gt;</code> for detail. This is one of the most frequent errors that we have in RT.</li>
</ul></li>
<li><code>process_message_queue.pl</code></li>
<li><code>gather_print_notices.pl</code></li>
</ul>
<h3 id="c4circulation.pm">C4/Circulation.pm</h3>
<ul>
<li><code>CHECKOUT</code></li>
<li><code>RENEWAL</code></li>
<li><code>CHECKIN</code></li>
</ul>
<h2 id="template-toolkit-an-effort-to-stem-the-madness.">Template toolkit: An effort to stem the madness.</h2>
<ul>
<li><a href="https://wiki.koha-community.org/wiki/Notices_and_Slips_Library#Notices_and_slips_using_template_toolkit">Examples here</a></li>
</ul>
